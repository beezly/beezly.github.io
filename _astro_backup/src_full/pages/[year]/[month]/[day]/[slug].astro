---
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');

  return posts.map((post) => {
    // Extract date from post ID (format: YYYY-MM-DD-slug)
    const match = post.id.match(/^(\d{4})-(\d{2})-(\d{2})-(.+)$/);
    if (!match) return null;

    const [, year, month, day] = match;

    return {
      params: { year, month, day, slug: post.id },
    };
  }).filter(Boolean);
}

export async function GET({ params, redirect }: any) {
  return redirect(`/blog/${params.slug}/`, 301);
}
---
